# ä¸ªäººçŸ¥è¯†ç®¡ç†Agentç³»ç»Ÿ - æ¶æ„è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-11-07
- **é€‚ç”¨äººå‘˜**: åç«¯å¼€å‘ã€æ¶æ„å¸ˆã€æ–°å…¥èŒå¼€å‘è€…

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹
ä¸ªäººçŸ¥è¯†ç®¡ç†Agentç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº **LangChain** å’Œ **RAG (Retrieval-Augmented Generation)** æŠ€æœ¯çš„æ™ºèƒ½çŸ¥è¯†ç®¡ç†åŠ©æ‰‹ã€‚ç³»ç»Ÿé‡‡ç”¨æ··åˆæ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§å…è´¹embeddingæ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨å®Œå…¨æ— APIä¾èµ–çš„æƒ…å†µä¸‹è¿è¡Œã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- **ğŸ’° é›¶æˆæœ¬è¿è¡Œ**: æ”¯æŒå®Œå…¨å…è´¹çš„embeddingæ–¹æ¡ˆï¼Œæ— éœ€ä»»ä½•APIè´¹ç”¨
- **ğŸ”’ éšç§ä¿æŠ¤**: æœ¬åœ°å‘é‡æ•°æ®åº“ï¼Œæ•°æ®ä¸ä¸Šä¼ äº‘ç«¯
- **ğŸ§  æ™ºèƒ½é™çº§**: APIä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å…è´¹æ–¹æ¡ˆ
- **ğŸ“š å¤šæ ¼å¼æ”¯æŒ**: PDFã€TXTã€Markdownã€DOCXæ–‡æ¡£å¤„ç†
- **ğŸ¯ é«˜å¯ç”¨æ€§**: å¤šå±‚æ¬¡é™çº§ç­–ç•¥ç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œ

### 1.3 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|----------|------|
| **è¿è¡Œç¯å¢ƒ** | Python | 3.8+ | æ ¸å¿ƒè¯­è¨€ |
| **AIæ¡†æ¶** | LangChain | 1.0+ | LLMåº”ç”¨æ¡†æ¶ |
| **å‘é‡æ•°æ®åº“** | ChromaDB | 0.4+ | æœ¬åœ°å‘é‡å­˜å‚¨ |
| **Webç•Œé¢** | Gradio | 5.0+ | å¿«é€Ÿæ­å»ºUI |
| **Embedding** | Sentence Transformers | 2.2+ | å…è´¹é«˜è´¨é‡åµŒå…¥ |
| **LLMæœåŠ¡** | DeepSeek API | - | å¯¹è¯ç”Ÿæˆ(å¯é€‰) |
| **æ–‡æ¡£è§£æ** | PyPDF2, python-docx | - | å¤šæ ¼å¼æ–‡æ¡£å¤„ç† |

---

## 2. æ•´ä½“æ¶æ„

### 2.1 ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¡¨ç°å±‚ (Presentation Layer)              â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  æ–‡ä»¶ä¸Šä¼ ç•Œé¢  â”‚  â”‚  æ™ºèƒ½é—®ç­”ç•Œé¢  â”‚  â”‚  æ–‡æ¡£ç®¡ç†ç•Œé¢  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                    Gradio Web UI                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)          â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ–‡æ¡£åŠ è½½å™¨     â”‚  â”‚  RAGç”Ÿæˆå™¨    â”‚  â”‚  æ··åˆæ£€ç´¢å™¨   â”‚      â”‚
â”‚  â”‚ DocumentLoaderâ”‚  â”‚  RAGGenerator â”‚  â”‚HybridRetrieverâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ LLMç®¡ç†å™¨     â”‚  â”‚ æ–‡æ¡£åˆ†ç±»å™¨    â”‚  â”‚ æç¤ºè¯ç®¡ç†    â”‚      â”‚
â”‚  â”‚ LLMManager   â”‚  â”‚Classifier    â”‚  â”‚ Prompts      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚ (Data Layer)                      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   å‘é‡å­˜å‚¨ç®¡ç†å™¨     â”‚          â”‚   Embeddingç®¡ç†å™¨   â”‚     â”‚
â”‚  â”‚   VectorStore      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ EmbeddingManager  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                â”‚                 â”‚
â”‚           â–¼                                â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ChromaDB å‘é‡åº“    â”‚          â”‚  å¤šæ–¹æ¡ˆEmbedding    â”‚     â”‚
â”‚  â”‚  (æœ¬åœ°æŒä¹…åŒ–)       â”‚          â”‚  â€¢ Sentence-T      â”‚     â”‚
â”‚  â”‚  â€¢ æ–‡æ¡£å‘é‡         â”‚          â”‚  â€¢ æ–‡æœ¬å“ˆå¸Œ         â”‚     â”‚
â”‚  â”‚  â€¢ å…ƒæ•°æ®ç´¢å¼•       â”‚          â”‚  â€¢ TF-IDF          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 2.2.1 è¡¨ç°å±‚ç»„ä»¶
| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|------|----------|------|
| GradioApp | `src/api/gradio_app.py` | Webç•Œé¢æ€»æ§åˆ¶å™¨ |
| KnowledgeManagerApp | `src/api/gradio_app.py` | åº”ç”¨ä¸»ç±»ï¼Œæ•´åˆæ‰€æœ‰åŠŸèƒ½ |

#### 2.2.2 ä¸šåŠ¡é€»è¾‘å±‚ç»„ä»¶
| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|------|----------|------|
| DocumentLoader | `src/ingestion/document_loader_simple.py` | æ–‡æ¡£åŠ è½½ä¸åˆ†å— |
| DocumentClassifier | `src/ingestion/document_loader_simple.py` | æ–‡æ¡£æ™ºèƒ½åˆ†ç±» |
| LLMManager | `src/generation/llm_manager.py` | LLMæ¨¡å‹ç®¡ç† |
| RAGGenerator | `src/generation/llm_manager.py` | RAGé—®ç­”ç”Ÿæˆ |
| HybridRetriever | `src/storage/vector_store_simple.py` | æ··åˆæ£€ç´¢å®ç° |

#### 2.2.3 æ•°æ®å±‚ç»„ä»¶
| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|------|----------|------|
| VectorStore | `src/storage/vector_store_simple.py` | å‘é‡æ•°æ®åº“æ“ä½œ |
| EmbeddingManager | `src/storage/embedding_manager.py` | å¤šæ–¹æ¡ˆEmbeddingç®¡ç† |

---

## 3. æ¨¡å—è®¾è®¡

### 3.1 ç›®å½•ç»“æ„

```
personal_knowledge_agent/
â”œâ”€â”€ main.py                          # åº”ç”¨å…¥å£
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py                  # å…¨å±€é…ç½®ç®¡ç†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                         # APIæ¥å£å±‚
â”‚   â”‚   â””â”€â”€ gradio_app.py           # Gradio Webåº”ç”¨
â”‚   â”œâ”€â”€ ingestion/                   # æ–‡æ¡£æ‘„å–å±‚
â”‚   â”‚   â”œâ”€â”€ document_loader.py      # æ–‡æ¡£åŠ è½½å™¨(å®Œæ•´ç‰ˆ)
â”‚   â”‚   â””â”€â”€ document_loader_simple.py # æ–‡æ¡£åŠ è½½å™¨(ç®€åŒ–ç‰ˆ)
â”‚   â”œâ”€â”€ storage/                     # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ vector_store.py         # å‘é‡å­˜å‚¨(å®Œæ•´ç‰ˆ)
â”‚   â”‚   â”œâ”€â”€ vector_store_simple.py  # å‘é‡å­˜å‚¨(ç®€åŒ–ç‰ˆ)
â”‚   â”‚   â””â”€â”€ embedding_manager.py    # Embeddingç®¡ç†å™¨
â”‚   â”œâ”€â”€ generation/                  # ç”Ÿæˆå±‚
â”‚   â”‚   â”œâ”€â”€ llm_manager.py          # LLMç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ prompts.py              # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ utils/                       # å·¥å…·å±‚
â”‚       â”œâ”€â”€ helpers.py              # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ logging.py              # æ—¥å¿—é…ç½®
â”œâ”€â”€ data/                            # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ vector_db/                  # å‘é‡æ•°æ®åº“å­˜å‚¨
â”œâ”€â”€ logs/                            # æ—¥å¿—ç›®å½•
â”œâ”€â”€ user_files/                      # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
â””â”€â”€ tests/                           # æµ‹è¯•æ–‡ä»¶

```

### 3.2 æ ¸å¿ƒæ¨¡å—ä¾èµ–å…³ç³»

```
main.py
  â”‚
  â””â”€> gradio_app.py (KnowledgeManagerApp)
        â”‚
        â”œâ”€> DocumentLoader (æ–‡æ¡£åŠ è½½)
        â”‚     â””â”€> DocumentClassifier (æ–‡æ¡£åˆ†ç±»)
        â”‚
        â”œâ”€> VectorStore (å‘é‡å­˜å‚¨)
        â”‚     â””â”€> EmbeddingManager (Embeddingç”Ÿæˆ)
        â”‚
        â”œâ”€> HybridRetriever (æ··åˆæ£€ç´¢)
        â”‚     â””â”€> VectorStore
        â”‚
        â””â”€> LLMManager (LLMç®¡ç†)
              â”œâ”€> RAGGenerator (RAGç”Ÿæˆ)
              â””â”€> EmbeddingManager
```

---

## 4. æ•°æ®æµè®¾è®¡

### 4.1 æ–‡æ¡£ä¸Šä¼ æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ–‡ä»¶éªŒè¯          â”‚
â”‚ â€¢ æ ¼å¼æ£€æŸ¥ (.pdfç­‰) â”‚
â”‚ â€¢ å¤§å°é™åˆ¶ (50MB)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å†…å®¹æå–          â”‚
â”‚ â€¢ PDF â†’ æ–‡æœ¬        â”‚
â”‚ â€¢ DOCX â†’ æ–‡æœ¬       â”‚
â”‚ â€¢ MD/TXT â†’ æ–‡æœ¬     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ–‡æœ¬åˆ†å—          â”‚
â”‚ â€¢ chunk_size: 1000  â”‚
â”‚ â€¢ overlap: 200      â”‚
â”‚ â€¢ ä¿æŒè¯­ä¹‰å®Œæ•´æ€§     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ–‡æ¡£åˆ†ç±»          â”‚
â”‚ â€¢ åŸºäºå…³é”®è¯è§„åˆ™     â”‚
â”‚ â€¢ æå–æ ‡ç­¾           â”‚
â”‚ â€¢ ç¡®å®šä¼˜å…ˆçº§         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Embeddingç”Ÿæˆ     â”‚
â”‚ â€¢ Sentence-T (ä¼˜å…ˆ) â”‚
â”‚ â€¢ æ–‡æœ¬å“ˆå¸Œ (å¤‡ç”¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å­˜å‚¨åˆ°ChromaDB    â”‚
â”‚ â€¢ å‘é‡æ•°æ®           â”‚
â”‚ â€¢ å…ƒæ•°æ®             â”‚
â”‚ â€¢ ç´¢å¼•æ„å»º           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ™ºèƒ½é—®ç­”æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æé—®     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æŸ¥è¯¢Embedding     â”‚
â”‚ â€¢ ä½¿ç”¨åŒä¸€æ–¹æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å‘é‡æ£€ç´¢          â”‚
â”‚ â€¢ è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—     â”‚
â”‚ â€¢ Top-K ç­›é€‰ (k=5)  â”‚
â”‚ â€¢ ç›¸å…³æ€§è¯„åˆ†         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸Šä¸‹æ–‡æ„å»º        â”‚
â”‚ â€¢ æ•´åˆæ£€ç´¢ç»“æœ       â”‚
â”‚ â€¢ æ·»åŠ å…ƒæ•°æ®         â”‚
â”‚ â€¢ æ ¼å¼åŒ–ä¸Šä¸‹æ–‡       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLMç”Ÿæˆ (å¯é€‰)    â”‚
â”‚ â€¢ DeepSeek API      â”‚
â”‚ â€¢ æç¤ºè¯å·¥ç¨‹         â”‚
â”‚ â€¢ å¸¦æ¥æºå¼•ç”¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ æœ‰API â”€â”€â”€â”€â”€â”€> è¿”å›AIç”Ÿæˆç­”æ¡ˆ
       â”‚
       â””â”€ æ— API â”€â”€â”€â”€â”€â”€> è¿”å›æ£€ç´¢ç»“æœæ‘˜è¦
```

### 4.3 æ··åˆæ£€ç´¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æŸ¥è¯¢    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚                  â”‚
       â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é‡è¯­ä¹‰æ£€ç´¢ â”‚    â”‚ å…³é”®è¯æ£€ç´¢   â”‚   â”‚ å…ƒæ•°æ®è¿‡æ»¤   â”‚
â”‚ (ä¸»è¦æ–¹å¼)   â”‚    â”‚ (å¾…å®ç°)     â”‚   â”‚ (å¯é€‰)       â”‚
â”‚ weight: 0.7 â”‚    â”‚ weight: 0.3 â”‚   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ ç»“æœèåˆä¸æ’åº   â”‚
                 â”‚ â€¢ ç»¼åˆè¯„åˆ†       â”‚
                 â”‚ â€¢ å»é‡å¤„ç†       â”‚
                 â”‚ â€¢ Top-K è¿”å›    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. è®¾è®¡æ¨¡å¼ä¸åŸåˆ™

### 5.1 åº”ç”¨çš„è®¾è®¡æ¨¡å¼

#### 5.1.1 ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
**åº”ç”¨åœºæ™¯**: EmbeddingManager å¤šæ–¹æ¡ˆé€‰æ‹©
```python
class EmbeddingManager:
    def __init__(self, preferred_method: str):
        # æ ¹æ®ç­–ç•¥é€‰æ‹©ä¸åŒçš„embeddingæ–¹æ³•
        if method == "sentence-transformers":
            return self._embed_sentence_transformers(texts)
        elif method == "text-hash":
            return self._embed_text_hash(texts)
        elif method == "bow-tfidf":
            return self._embed_bow_tfidf(texts)
```

#### 5.1.2 å·¥å‚æ¨¡å¼ (Factory Pattern)
**åº”ç”¨åœºæ™¯**: DocumentLoader æ–‡æ¡£å¤„ç†
```python
def load_file(self, file_path: str):
    # æ ¹æ®æ–‡ä»¶ç±»å‹åˆ›å»ºä¸åŒçš„å¤„ç†å™¨
    if file_extension == ".pdf":
        content = self._extract_pdf_text(file_path)
    elif file_extension == ".docx":
        content = self._extract_docx_text(file_path)
    # ...
```

#### 5.1.3 å•ä¾‹æ¨¡å¼ (Singleton Pattern)
**åº”ç”¨åœºæ™¯**: Settings é…ç½®ç®¡ç†
```python
# å…¨å±€å•ä¸€é…ç½®å®ä¾‹
settings = Settings()
```

### 5.2 SOLIDåŸåˆ™åº”ç”¨

| åŸåˆ™ | åº”ç”¨ç¤ºä¾‹ |
|------|----------|
| **S** å•ä¸€èŒè´£ | DocumentLoaderåªè´Ÿè´£åŠ è½½ï¼ŒDocumentClassifieråªè´Ÿè´£åˆ†ç±» |
| **O** å¼€é—­åŸåˆ™ | EmbeddingManagerå¯æ‰©å±•æ–°æ–¹æ¡ˆï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç  |
| **L** é‡Œæ°æ›¿æ¢ | å®Œæ•´ç‰ˆå’Œç®€åŒ–ç‰ˆVectorStoreå¯äº’ç›¸æ›¿æ¢ |
| **I** æ¥å£éš”ç¦» | RAGGeneratorå’Œç®€åŒ–å›ç­”æ¨¡å¼åˆ†ç¦» |
| **D** ä¾èµ–å€’ç½® | ä¾èµ–æŠ½è±¡çš„LangChainæ¥å£ï¼Œè€Œéå…·ä½“å®ç° |

---

## 6. å¯é æ€§è®¾è®¡

### 6.1 å¤šå±‚é™çº§ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Embeddingæ–¹æ¡ˆé™çº§é“¾                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£ OpenAI API (æœ€é«˜è´¨é‡ï¼Œéœ€APIå¯†é’¥)                      â”‚
â”‚             â†“ (APIä¸å¯ç”¨)                                â”‚
â”‚  2ï¸âƒ£ Sentence Transformers (å…è´¹ï¼Œé«˜è´¨é‡)                 â”‚
â”‚             â†“ (æ¨¡å‹ä¸‹è½½å¤±è´¥/ç½‘ç»œé—®é¢˜)                     â”‚
â”‚  3ï¸âƒ£ æ–‡æœ¬å“ˆå¸Œ (é›¶ä¾èµ–ï¼Œä¿åº•æ–¹æ¡ˆ)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLMå›ç­”ç”Ÿæˆé™çº§é“¾                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£ DeepSeek RAGç”Ÿæˆ (æ™ºèƒ½å›ç­”ï¼Œéœ€APIå¯†é’¥)               â”‚
â”‚             â†“ (APIä¸å¯ç”¨)                                â”‚
â”‚  2ï¸âƒ£ åŸºäºæ£€ç´¢ç»“æœçš„æ‘˜è¦ (ç®€åŒ–å›ç­”ï¼Œæ— éœ€API)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å¼‚å¸¸å¤„ç†æœºåˆ¶

```python
# æ¯ä¸ªå…³é”®æ“ä½œéƒ½æœ‰ try-except ä¿æŠ¤
try:
    # ä¸»è¦é€»è¾‘
    result = primary_method()
except Exception as e:
    logger.warning(f"ä¸»æ–¹æ¡ˆå¤±è´¥: {e}")
    # é™çº§æ–¹æ¡ˆ
    result = fallback_method()
```

### 6.3 æ—¥å¿—ä¸ç›‘æ§

| æ—¥å¿—çº§åˆ« | ä½¿ç”¨åœºæ™¯ |
|---------|----------|
| **INFO** | æ­£å¸¸æ“ä½œæµç¨‹ã€é…ç½®ä¿¡æ¯ |
| **WARNING** | é™çº§ç­–ç•¥è§¦å‘ã€éè‡´å‘½é”™è¯¯ |
| **ERROR** | æ“ä½œå¤±è´¥ã€å¼‚å¸¸æƒ…å†µ |
| **DEBUG** | è¯¦ç»†æ‰§è¡Œä¿¡æ¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰ |

---

## 7. æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 7.1 Embeddingç¼“å­˜æœºåˆ¶
```python
# ç›¸åŒæ–‡æœ¬å¤ç”¨embedding
if text in self.embedding_cache:
    return self.embedding_cache[text]
```

### 7.2 æ‰¹é‡å¤„ç†ä¼˜åŒ–
```python
# æ‰¹é‡ç”Ÿæˆembeddingï¼Œå‡å°‘æ¨¡å‹è°ƒç”¨æ¬¡æ•°
embeddings = self.model.encode(texts, batch_size=32)
```

### 7.3 å‘é‡æ£€ç´¢ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**: ChromaDB è‡ªåŠ¨ç»´æŠ¤HNSWç´¢å¼•
- **Top-Ké™åˆ¶**: é»˜è®¤è¿”å›5ä¸ªç»“æœï¼Œé¿å…è¿‡åº¦æ£€ç´¢
- **ç›¸å…³æ€§é˜ˆå€¼**: è¿‡æ»¤ä½ç›¸å…³æ€§ç»“æœ

---

## 8. æ‰©å±•æ€§è®¾è®¡

### 8.1 æ–°å¢Embeddingæ–¹æ¡ˆ
```python
# åœ¨ EmbeddingManager ä¸­æ·»åŠ æ–°æ–¹æ³•
def _try_new_embedding_method(self) -> bool:
    """å°è¯•æ–°çš„embeddingæ–¹æ³•"""
    # å®ç°é€»è¾‘
    pass
```

### 8.2 æ–°å¢æ–‡æ¡£æ ¼å¼æ”¯æŒ
```python
# åœ¨ DocumentLoader ä¸­æ·»åŠ æ–°è§£æå™¨
def _extract_new_format_text(self, file_path: Path) -> str:
    """æå–æ–°æ ¼å¼æ–‡æœ¬"""
    # å®ç°é€»è¾‘
    pass
```

### 8.3 æ–°å¢LLMæä¾›å•†
```python
# åœ¨ LLMManager ä¸­æ·»åŠ æ–°æ¨¡å‹
if provider == "new_provider":
    self.chat_model = NewProviderChat(...)
```

---

## 9. å®‰å…¨æ€§è®¾è®¡

### 9.1 æ•°æ®éšç§
- âœ… å‘é‡æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ äº‘ç«¯
- âœ… å¯é€‰çš„APIè°ƒç”¨ï¼ˆç”¨æˆ·è‡ªä¸»é€‰æ‹©ï¼‰
- âœ… æ–‡ä»¶å†…å®¹ä¸æ³„éœ²åˆ°ç¬¬ä¸‰æ–¹

### 9.2 è¾“å…¥éªŒè¯
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ (50MB)
- âœ… æ–‡ä»¶æ ¼å¼ç™½åå• (.pdf, .txt, .md, .docx)
- âœ… è·¯å¾„å®‰å…¨æ£€æŸ¥

### 9.3 é”™è¯¯å¤„ç†
- âœ… é¿å…æ•æ„Ÿä¿¡æ¯åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ³„éœ²
- âœ… æ—¥å¿—ä¸­ä¸è®°å½•æ–‡ä»¶å®Œæ•´å†…å®¹
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

---

## 10. é…ç½®ç®¡ç†

### 10.1 ç¯å¢ƒå˜é‡é…ç½®
```env
# å¯é€‰APIå¯†é’¥
OPENAI_API_KEY=sk-xxx
DEEPSEEK_API_KEY=sk-xxx

# Embeddingæ–¹æ¡ˆé€‰æ‹©
EMBEDDING_METHOD=auto  # auto | openai | all-MiniLM-L6-v2 | text-hash

# æ•°æ®åº“è·¯å¾„
VECTOR_DB_PATH=./data/vector_db

# RAGå‚æ•°
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
TOP_K=5
```

### 10.2 æ™ºèƒ½é…ç½®é€‰æ‹©
```python
@classmethod
def get_optimal_embedding_method(cls) -> str:
    """æ™ºèƒ½é€‰æ‹©æœ€ä½³embeddingæ–¹æ³•"""
    if cls.OPENAI_API_KEY:
        return "openai"
    else:
        try:
            import sentence_transformers
            return "all-MiniLM-L6-v2"
        except ImportError:
            return "text-hash"
```

---

## 11. åç»­ä¼˜åŒ–æ–¹å‘

### 11.1 çŸ­æœŸä¼˜åŒ–
- [ ] å®ç°BM25å…³é”®è¯æœç´¢ç®—æ³•
- [ ] ä¼˜åŒ–ç›¸å…³æ€§è¯„åˆ†ç®—æ³•
- [ ] å¢åŠ å‘é‡æ£€ç´¢ç¼“å­˜æœºåˆ¶

### 11.2 ä¸­æœŸä¼˜åŒ–
- [ ] æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼ (PPT, Excelç­‰)
- [ ] å®ç°æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†
- [ ] å¢åŠ ç”¨æˆ·æƒé™ç®¡ç†

### 11.3 é•¿æœŸä¼˜åŒ–
- [ ] åˆ†å¸ƒå¼å‘é‡æ£€ç´¢
- [ ] å¤šæ¨¡æ€æ”¯æŒ (å›¾åƒã€éŸ³é¢‘)
- [ ] çŸ¥è¯†å›¾è°±é›†æˆ

---

## 12. å‚è€ƒèµ„æ–™

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [ChromaDB æ–‡æ¡£](https://docs.trychroma.com/)
- [Sentence Transformers](https://www.sbert.net/)
- [Gradio æ–‡æ¡£](https://www.gradio.app/docs)

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚æœ‰æ¶æ„å˜æ›´ï¼Œè¯·åŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£
**è”ç³»æ–¹å¼**: é¡¹ç›®ç»´æŠ¤è€…
